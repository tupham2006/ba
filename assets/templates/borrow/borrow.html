<div id="borrowLeft">
	<div class="filter">
		<div>
			<input type="text" ng-model="filter.typing" ng-change="getBorrowList()" placeholder="Tìm tên, số điện thoại" class="form-control">
		</div>
		<div>
			<input type="text" date-range-picker class="form-control date-picker" ng-change="getBorrowList()" ng-model="filter.date" options="dateOption" >
		</div>
	</div>
	<div class="background-parent">
		<div class="background-child">
			<div ng-repeat="borrow in borrowList">
				<div class="borrow-date" ng-show="(borrowList[$index].borrow_date | date: 'dd/MM/yyyy') != (borrowList[$index - 1].borrow_date | date: 'dd/MM/yyyy')">
					<div class="borrow-date-number">
						{{ borrow.borrow_date | dayInWeek}}
					</div>
					<div class="borrow-date-date">
						{{ borrow.borrow_date | date: 'dd/MM/yyyy'}}
					</div>
				</div>
				<div class="clear"></div>
				<div class="borrow-info" ng-click="showBorrowDetail(borrow.id)" ng-class="{'borrow-hightlight': borrow.is_selected, 'borrow-borrowed-status': !borrow.status }">
					<div class="image">
						<avatar ng-model="reader.image" av-size="50" av-type="'user'" av-shape="50"></avatar>
					</div>
					<div class="content">
						<div class="reader-name">
							{{ borrow.reader_name }}
							<button ng-show="borrow.status" ng-click="saveBorrow('BORROW_NOW')" class="btn btn-sm btn-white fast-borrow">Trả ngay</button>
						</div>
						<div class="book-name">
							<span class="mr-5 label" ng-class="{'bg-green': borrow.status, 'bg-gray-69': !borrow.status }" ng-repeat="book in borrow.book track by $index">
								 {{ book.book_name }} 
							</span>
						</div>
						<div class="deposit-name">	
							<span>
								<i class="fa fa-credit-card"></i> {{ borrow.deposit_name }}
							</span>
							<span class="ml-10">
								<i class="fa fa-mobile"></i> {{ borrow.reader_mobile | tel }}
							</span>
						</div>
					</div>
				</div>
				<div class="clear"></div>
			</div>
		</div>
	</div>
</div>
<div  id="borrowCenter" name="myForm">
	<div class="row">
		<div class="col-md-12">
			<div id="viewBorrow" ng-hide="viewMode != 'BORROW'">
				<div class="row mb-20">
					<div class="col-xs-12" style="min-height: 34px">
						<label ng-show="borrowInfo.id" class="text-green"><span class="fa fa-info-circle"></span> Chi tiết lượt mượn</label>
						<label ng-show="!borrowInfo.id" class="text-green"><span class="fa fa-info-circle"></span> Tạo lượt mượn mới</label>
						<button  ng-show="borrowInfo.id" class="btn btn-blue pull-right" ng-click="showBorrowDetail()">Tạo mới</button>
					</div>
				</div>
				<div class="row mb-10">
					<label class="label-control col-md-4 required-field">Số điện thoại</label>
					<div class="col-xs-8">
						<input type="text" ng-disabled="existReader && borrowInfo.id" ng-model="borrowInfo.reader_mobile" placeholder="Hệ thống sẽ tìm kiếm nếu số điện thoại tồn tại" ng-blur="_validate('mobile', borrowInfo.reader_mobile)" ng-change="_validate('mobile', borrowInfo.reader_mobile); findReaderByMobile()" class="form-control" ui-mask="9999 999 9999" ui-mask-placeholder ui-mask-placeholder-char=" ">
						<span class="validation-error-label" ng-show="_error.mobile"> Bạn chưa nhập số điện thoại </span>
					</div>
				</div>
				<div class="row mb-10">
					<label class="label-control col-md-4 required-field">Tên Bạn Đọc</label>
					<div class="col-xs-8">
							<input type="text" ng-disabled="existReader" class="form-control" ng-change="_validate('name', borrowInfo.reader_name)" ng-blur="_validate('name', borrowInfo.reader_name)" ng-model="borrowInfo.reader_name">
							<span class="validation-error-label" ng-show="_error.name"> Bạn chưa nhập tên bạn đọc </span>
					</div>
				</div>
				<div class="row mb-10">
					<label class="label-control col-md-4">Khoa</label>
					<div class="col-xs-5">
						<facutly-select ng-model="borrowInfo.facutly" edit-mode="true"></facutly-select>
					</div>
					<div class="label-control col-md-1 text-right p-0">K.</div>
					<div class="col-md-2">
						<input type="text" class="form-control" ng-model="borrowInfo.course">
					</div>
				</div>
				
				<div class="row mb-10">
					<label class="label-control col-md-4">Tên sách</label>
					<div class="col-md-8">
						<span ng-show="!borrowInfo.book.length">Bấm vào sách trong danh sách sách ở bên phải để chọn</span>
						<span ng-repeat="book in borrowInfo.book" class="tags width-100">
							<div>
								<span class="pull-left">{{book.book_name}}</span>
								<span class="pull-right">
									<a ng-show="book.status" class="text-green" href="javascript:void(0)" ng-click="borrowABook(book.book_id)"> Trả sách</a>
									<span ng-show="!book.status" class="text-blue">(Đã trả)</span>
									<i class="fa fa-close text-red" ng-click="removeBookFromBorrow(book.book_id)"></i>
								</span>
							</div>
						</span>
						<span class="validation-error-label" ng-show="_error.array"> Bạn chưa chọn sách mượn</span>
					</div>
				</div>
				<div class="row mb-10" ng-show="borrowInfo.id">
					<label class="label-control col-md-4">Trạng thái</label>
					<div class="col-xs-8">
						<span class="mr-20">
							<label class="cursor-pointer text-normal" for="status1">Đang mượn</label>
							<input type="radio" class="cursor-pointer" id="status1" ng-click="whenChangeStatus()" ng-model="borrowInfo.status" name="status" ng-value="1">
						</span> 
						<span>
							<label class="cursor-pointer text-normal" for="status0">Đã trả</label> 
							<input type="radio" class="cursor-pointer" id="status0" ng-click="whenChangeStatus()" name="status" ng-model="borrowInfo.status" ng-value="0">
						</span>
					</div>
				</div>
				<div class="row mb-10">
					<label class="label-control col-md-4">Ngày mượn</label>
					<div class="col-xs-8">
							<input type="text" date-range-picker class="form-control date-picker" ng-readonly="true" ng-model="borrowDate.date" options="borrowDateOption">
					</div>
				</div>
				<div ng-show="!borrowInfo.status">
					<div class="row mb-10">
						<label class="label-control col-md-4">Ngày trả</label>
						<div class="col-xs-8">
							<input type="text" date-range-picker class="form-control date-picker" ng-readonly="true" ng-change="changePayDate()" ng-model="payDate.date" options="payDateOption">
						</div>
					</div>
					<div class="row mb-10">
						<div class="col-xs-8 col-xs-push-4 text-red">
							* Thời gian mượn sách:	{{ borrowInfo.warning_borrow_time | numberDay }}
						</div>
					</div>
				</div>
				<div>
					
				</div>
				<div class="row mb-10">
					<label class="label-control col-md-4">Đặt cọc</label>
					<div class="col-xs-8">
						<deposit-select ng-model="borrowInfo.deposit_id" edit-mode="true"></deposit-select>
					</div>
				</div>
				<div class="row mb-10">
					<label class="label-control col-md-4">Ghi chú</label>
					<div class="col-xs-8">
						<textarea type="text" ng-model="borrowInfo.note" class="form-control"></textarea>
					</div>
				</div>
				<div class="row mb-10">
					<div class="col-xs-3 pull-left">
						<button type="button" ng-show="borrowInfo.id" title="Xóa" ng-click="deleteBorrow(borrowInfo.id)" class="btn btn-red btn-label btn-icon" style="width: 34px;">
							<b><i ng-show="deleteLoading" class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i></b>
							<b ng-show="!deleteLoading" class="fa fa-trash-o"></b>
						</button>
						<button type="button" title="Làm mới" ng-click="showBorrowDetail(borrowInfo.id)" class="btn btn-white btn-icon btn-label"><b class="fa fa-refresh"></b></button>
					</div>
					<div class="col-xs-3 pull-right">
						<button type="button" ng-click="saveBorrow()" class="btn btn-green width-100 text-green btn-label">
							<b><i ng-show="saveLoading" class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i></b>
							<b ng-show="!saveLoading" class="fa fa-save"></b> Lưu
						</button>
					</div>
				</div>
			</div>
			<div id="viewBook" ng-show="viewMode == 'BOOK'">
				<div id="bookDetailHeader">
					<div class="book-detail-avatar">
						<book-img ng-model="book.image" av-size="150"></book-img>
					</div>
					<div class="book-info">
						<div class="font-20">{{ bookInfo.name }}</div>
						Tác giả: {{ bookInfo.author }}<br>
						Số lần mượn: {{ bookInfo.hot }}<br>
						Trạng thái: <span ng-show="bookInfo.status == 1"><i class="fa fa-check-circle" aria-hidden="true"></i> Sẵn sàng để mượn</span><span ng-show="bookInfo.status == 0"><i class="fa fa-exclamation-circle" aria-hidden="true"></i> Đã mượn</span>
					</div>
				</div>
				<div id="bookDetailContent">
					<div class="description-content">
						{{ bookInfo.description }}
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div id="borrowRight">
	<div class="filter">
		<div>
				<book-type-select ng-model="bookFilter.type_id" ng-change="getBookList()"></book-type-select>
		</div>
		<div>
			<input type="text" ng-model="bookFilter.typing" ng-change="getBookList()" placeholder="Tên sách" class="form-control">
		</div>
	</div>
	<div class="right-parent">
		<div ng-repeat ="book in bookList track by $index" class="book-item" ng-class="{'ready': book.current_quantity > 0, 'not-ready': book.current_quantity < 1}">
			<div ng-click="showBookDefail(book.id)" class="book-image"> <book-img ng-model="book.image" av-size="40"></book-img> </div>
			<div class="book-content" ng-class="book.current_quantity < 1 ? 'point-e-n' : ''" ng-click="addBookToBorrow(book.id, book.name)">{{ book.name }}
				<div ng-show="(book.current_quantity > 1) || (book.use_quantity > 1 && book.current_quantity > 0)" ng-class="book.current_quantity < 1 ? 'btn-red' : 'btn-green'" class="borrow-current-quantity text-center">{{ book.current_quantity }}</div>
			</div>
			<div class="clear-both"></div>
		</div>
	</div>
</div>
